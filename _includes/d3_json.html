<script src="https://d3js.org/d3.v5.js"></script>
<div id="chart_div"><svg class="chart"></svg></div>
<script>
    console.log('load');
d3.json('../../../../public/data/uk_emissions.json').then(function(data) {
    var margin = {top: 10, right: 10, bottom: 10, left: 10},
  width = 600 - margin.left - margin.right,
  height = 600 - margin.top - margin.bottom;
    
    const treemap = d3.treemap()
    .size([width,height])
    .paddingOuter(5);
    var root = d3.hierarchy(data);
    console.log(root.leaves());
    root.sum(d => d.value);
    treemap(root);

    var color = d3.scaleOrdinal(d3.schemeCategory10);
    var opacity = d3.scaleLinear();

    var chart = d3.select(".chart").attr("width",  width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");


      // create a tooltip
  var Tooltip = d3.select("#chart_div")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")

// Three function that change the tooltip when user hover / move / leave a cell
var mouseover = function(d) {
    Tooltip
      .style("opacity", 1)
    d3.select(this)
      .style("stroke", "black")
      .style("opacity", 1)
  }
  var mousemove = function(d) {
    console.log(`move: ${d.value}`)
    Tooltip
      .html("The exact value of<br>this cell is: " + d.value)
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px")
  }
  var mouseleave = function(d) {
    Tooltip
      .style("opacity", 0)
    d3.select(this)
      .style("stroke", "none")
      .style("opacity", 0.8)
  }


    var square = chart.selectAll("rect")
    .data(root.leaves())
    .enter()
    .append('rect')
    .attr('x', d => d.x0)
    .attr('y', d => d.y0)
    .attr('width', d => d.x1 - d.x0)
    .attr('height', d => d.y1 - d.y0)
    .style('fill', d => color(d.parent.parent.data.name))
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave)
    // .style('opacity', d => opacity(d.data.value))

  chart
    .selectAll("GHG")
    .data(root.descendants().filter(function(d){return d.depth==1}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0})
      .attr("y", function(d){ return d.y0})
      .text(function(d){ return d.data.name })
      .attr("font-size", "11px")
      .attr("fill",  function(d){ return color(d.data.name)} )
      

      //   chart
    // .selectAll("industry")
    // .data(root.descendants().filter(function(d){return d.depth==2}))
    // .enter()
    // .append("text")
    //   .attr("x", function(d){ return d.x0})
    //   .attr("y", function(d){ return d.y0})
    //   .text(function(d){ return d.data.name })
    //   .attr("font-size", "11px")
    //   .attr("fill",  function(d){ return color(d.data.name)} )
    // chart.selectAll("text")
    // .data(root.leaves())
    // .enter()
    // .append("text")
    // .attr("x", function(d){ return d.x0+1})    // +10 to adjust position (more right)
    //   .attr("y", function(d){ return d.y0+1})    // +20 to adjust position (lower)
    //   .text(function(d){ return d.data.name })
    //   .attr("font-size", "3px")
    //   .attr("fill", "white")

});
console.log('after json');
     </script>
